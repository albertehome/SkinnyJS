!function(t){t.modalDialog=t.modalDialog||{};var e,i,o=t.modalDialog._ua=(e=navigator.userAgent).indexOf("MSIE 7.0")>0?{ie:!0,ie7:!0,version:7,compat:e.indexOf("compatible")>0}:e.indexOf("MSIE 8.0")>0?{ie:!0,ie8:!0,version:8,compat:e.indexOf("compatible")>0}:{};t.modalDialog.setSmallScreen=function(t){i=t},t.modalDialog.isSmallScreen=function(){if(void 0!==i)return i;if(o.ie7||o.ie8)return!1;var e=t(window).width();return("number"==typeof window.orientation?Math.min(e,t(window).height()):e)<=480}}(jQuery),function(t){var e=function(t){return""===t?t:t||null},i=function(t){if(t)switch(t=t.toString().toLowerCase()){case"true":case"yes":case"1":return!0}return!1},o=function(t){return t?new Function("event",t):null},n={title:e,onopen:o,onbeforeopen:o,onclose:o,onbeforeclose:o,maxWidth:parseInt,initialHeight:parseInt,ajax:i,onajaxerror:o,destroyOnClose:i,skin:e,enableHistory:i,closeOnBackgroundClick:i,closeOnEscape:i,zIndex:parseInt};t.modalDialog=t.modalDialog||{},t.modalDialog.getSettings=function(e){var i={};return t.each(function(t){if(Object.keys)return Object.keys(t);var e=[];for(var i in t)t.hasOwnProperty(i)&&(e[e.length]=i);return e}(n),function(t,o){var r=e.attr("data-dialog-"+o);if(void 0!==r){var a=n[o];i[o]=a(r)}}),i}}(jQuery),function(t){if(t.modalDialog&&t.modalDialog._isContent)throw new Error("Attempt to load jquery.modalDialogContent.js in the same window as jquery.modalDialog.js.");var e=[],i={};t.modalDialog.defaults={zIndex:1e4,title:"",maxWidth:600,initialHeight:100,skin:"primary",ajax:!1,url:null,content:null,destroyOnClose:!1,containerElement:"body",preventEventBubbling:!1,enableHistory:!0,closeOnBackgroundClick:!0,closeOnEscape:!0,onopen:null,onclose:null,onbeforeopen:null,onbeforeclose:null,onajaxerror:null};var o=t.modalDialog._ua;t.modalDialog.iframeLoadTimeout=0,t.modalDialog.animationDuration=250;var n=function(e){this.settings=e,this.parent=t(this.settings.containerElement||"body"),t.each(["open","beforeopen","close","beforeclose","ajaxerror"],t.proxy(this._setupCustomEvent,this)),t.proxyAll(this,"_drag","_startDrag","_stopDrag","_close","_clickclose","_keydownHandler")};n.prototype.dialogType="node",n.prototype._setupCustomEvent=function(e,i){var o="on"+i,n=t.CustomEvent.create(this,i),r=this.settings[o];return r&&n.add(r),n},n.prototype._initDeferred=function(e,i){return this._deferreds=this._deferreds||{},i=i||new t.Deferred,this._deferreds[e]=i,i},n.prototype._completeDeferred=function(t,e,i){var o=this._deferreds[t];if(o)return o[e+"With"](this,i),o;throw new Error("No deferred initialized for action '"+t+"'")},n.prototype._resolveDeferred=function(t,e){return this._completeDeferred(t,"resolve",e)},n.prototype._rejectDeferred=function(t,e){return this._completeDeferred(t,"reject",e)},n.prototype._clearDeferred=function(t){this._deferreds[t]=null},n.prototype._getDeferred=function(t){return this._deferreds[t]},n.prototype._isDeferredComplete=function(t){var e=this._getDeferred(t);return!e||"pending"!=e.state()},n.prototype.isOpen=function(){return!!this._open},n.prototype.open=function(i){var o=this._initDeferred("open",o);if(this._open)return this._rejectDeferred("open");this.level=e.length;var n=this.onbeforeopen.fire();return n.isDefaultPrevented()?this._rejectDeferred("open"):(n=t.modalDialog.onbeforeopen.fire(null,this)).isDefaultPrevented()?this._rejectDeferred("open"):(e.push(this),this.level>0&&(this.settings.parentId=e[this.level-1].settings._fullId),this._open=!0,this._build(),this.$container[t.modalDialog.isSmallScreen()?"addClass":"removeClass"]("smallscreen"),this.$container.stop(!0,!0),this.$el.show(),this._showLoadingIndicator(),t(document).on("keydown",this._keydownHandler),this._finishOpenAction=function(){if("rejected"!=o.state()){this.$bg.addClass(t.modalDialog.veilClass);var e=this._getDefaultWidthData();this.$container.css({width:e.width}),this.$container.css("opacity",0);var n=this._getDefaultPosition(),r=n.top;this.$container.css(n);var a=t.proxy(function(){try{this.$el.addClass("dialog-visible"),t.modalDialog.isSmallScreen()&&(this.triggerWindowResize=!1,this._orientationchange=t.proxy(function(t){return this.triggerWindowResize=!0,this.pos(t)},this),t(window).on("orientationchange resize",this._orientationchange)),this.onopen.fire(),t.modalDialog.onopen.fire(null,this),this._resolveDeferred("open")}catch(t){this._rejectDeferred("open",t)}this._clearDeferred("open")},this);i?(this.$container.css({top:r}),setTimeout(a,0)):this.$container.animate({opacity:1},t.modalDialog.animationDuration,"swing").promise().then(a,a)}else this._clearDeferred("open");this._hideLoadingIndicator()},this._finishOpen(),o.promise())},n.prototype._finishOpen=function(){if(this._finishOpenAction){try{this._finishOpenAction()}catch(t){this._rejectDeferred("open",t),this._clearDeferred("open")}this._finishOpenAction=null}},n.prototype._keydownHandler=function(e){27==e.keyCode&&this.settings.closeOnEscape&&t.modalDialog.getCurrent()===this&&this.cancel()},n.prototype.cancel=function(){this.$container&&this.$container.stop(!0,!1),this.isOpen()&&this.close()},n.prototype._showLoadingIndicator=function(){this.$loadingIndicator||(this.$loadingIndicator=t("<div class='dialog-loading-indicator'><span></span></div>").appendTo(this.$bg))},n.prototype._hideLoadingIndicator=function(){this.$loadingIndicator.remove(),this.$loadingIndicator=null},n.prototype._popDialogStack=function(){t.modalDialog.getCurrent()===this&&e.pop()},n.prototype.close=function(e){var i=this._initDeferred("close",i);if(t.modalDialog.getCurrent()!==this)return this._rejectDeferred("close");var o={isDialogCloseButton:!!e};return this.onbeforeclose.fire(o).isDefaultPrevented()?this._rejectDeferred("close"):t.modalDialog.onbeforeclose.fire(o,this).isDefaultPrevented()?this._rejectDeferred("close"):(this._popDialogStack(),t(document).off("keydown",this._keydownHandler),this.$el.removeClass("dialog-visible"),this.$container.animate({opacity:0},t.modalDialog.animationDuration,"swing").promise().then(t.proxy(function(){try{this._finishClose(o)}catch(t){this._rejectDeferred("close",t),this._clearDeferred("close")}},this),t.proxy(function(t){this._rejectDeferred("close",t),this._clearDeferred("close")},this)),this._orientationchange&&t(window).off("orientationchange resize",this._orientationchange),i.promise())},n.prototype._close=function(t){t.preventDefault(),this.close(!1)},n.prototype._clickclose=function(t){t.preventDefault(),this.close(!0)},n.prototype._reset=function(){this._open=!1,this.$container.stop(!0,!0),this.$container.css({top:"-700px"}),this.$bg.removeClass(t.modalDialog.veilClass),this.$el.hide()},n.prototype._resetFailed=function(){this._reset(),this._popDialogStack()},n.prototype._finishClose=function(e){this._reset(),this.settings.destroyOnClose&&this._destroy(),t.modalDialog.isSmallScreen()&&this.triggerWindowResize&&t(window).trigger("resize"),setTimeout(t.proxy(function(){this.onclose.fire(e),t.modalDialog.onclose.fire(e,this),this._resolveDeferred("close")},this),0)},n.prototype._destroy=function(){this._destroyed||(this.$content.detach().appendTo("body"),this.$el.remove(),delete i[this.settings._fullId],this._destroyed=!0)},n.prototype._updateZIndexes=function(){var t=this.settings.zIndex,e=this.getParent();e&&(t=Math.max(e.settings.zIndex+10,t)),this.$bg.css("z-index",t),t+=2,this.$container.css("z-index",t)},n.prototype._preventClickBubbling=function(t){var e=this;t.on("click mousedown mouseup touchstart touchend",function(t){e.settings.preventEventBubbling&&t.stopPropagation()})},n.prototype._build=function(){if(this._destroyed)throw new Error("This dialog has been destroyed");this.$el?this._alreadyBuilt():(this.$bg=t('<div class="dialog-background"></div>'),this.$container=t('<div class="dialog-container" id="'+this.settings._fullId+'Container">  <div class="dialog-header">    <a href="#" class="dialog-close-button"><span class="dialog-close-button-icon"></span></a>    <h2 class="dialog-header-text">'+(this.settings.title||"")+'</h2>  </div>  <div class="dialog-content-container">  </div></div>'),this._preventClickBubbling(this.$bg),this._preventClickBubbling(this.$container),this.$el=t([this.$bg[0],this.$container[0]]).addClass("dialog-skin-"+this.settings.skin),this.parent.append(this.$bg,this.$container),this.parent.is("body")||this.parent.hasClass("ui-page-active")||(this.$bg.css("position","absolute"),"static"==this.parent.css("position")&&this.parent.css("position","relative")),this.$contentContainer=this.$el.find(".dialog-content-container"),this.$header=this.$el.find(".dialog-header"),this.$closeButton=this.$el.find(".dialog-close-button").on("click",this._clickclose),this.settings.closeOnBackgroundClick&&this.$bg.on("click",this._close),this._buildContent(),this.$contentContainer.on("click",'*[data-action="close"]',this._clickclose),this.$contentContainer.append(this.$content),!this.parent.is("body")&&!this.parent.hasClass("ui-page-active")||o.ie7||this._makeDraggable()),this._updateZIndexes()},n.prototype._alreadyBuilt=function(){this.$content.parent()[0]!==this.$contentContainer[0]&&(this._buildContent(),this.$contentContainer.append(this.$content))},n.prototype._getChromeHeight=function(){return this._chromeHeight||(this._chromeHeight=this.$container.height()-this.$content.height()),this._chromeHeight},n.prototype._getDefaultWidthData=function(){var e=t(window),i=this.parent.is("body")?window.innerWidth||e.width():this.parent.width();return{windowWidth:i,width:Math.min(i-20,this.settings.maxWidth)}},n.prototype._getDefaultPosition=function(e){var i=this._getDefaultWidthData(),n=t(document).scrollTop(),r={width:i.width,top:n+10};r.left=(i.windowWidth-r.width)/2;var a=t.modalDialog.isSmallScreen();if((o.ie7||a)&&(r.top=10),!a){e=e||this.$content.height();var s=this._getChromeHeight()+e,l=(this.parent.is("body")?t(window).height():this.parent.height())/2-s/2+n;r.top=Math.max(l,r.top)}return r},n.prototype._makeDraggable=function(){t.modalDialog.isSmallScreen()||this.$header.addClass("draggable").on("pointerdown",this._startDrag)},n.prototype._startDrag=function(e){var i=t(e.target);i.is(this.$closeButton)||i.is(this.$closeButton.children())||(e.stopPropagation(),e.preventDefault(),this._initialMousePos=r(e),this._initialDialogPos=this.$container.offset(),t(document).on("pointermove",this._drag),this.$header.on("pointerup",this._stopDrag),this.$bg.on("pointerup",this._stopDrag),this.$frame&&(this._overlay=t("<div class='dialog-content-overlay'>").appendTo(this.$contentContainer)),this._isDragging=!0)},n.prototype._drag=function(e){if(this._isDragging){var i=r(e),o=i.top-this._initialMousePos.top,n=i.left-this._initialMousePos.left,a={top:this._initialDialogPos.top+o,left:this._initialDialogPos.left+n};this.$container.css(a)}else t(document).off("pointermove",this._drag)},n.prototype._stopDrag=function(){delete this._initialMousePos,delete this._initialDialogPos,t(document).off("pointermove",this._drag),this.$header.off("pointerup",this._stopDrag),this.$bg.off("pointerup",this._stopDrag),this._overlay&&(this._overlay.remove(),delete this._overlay),this._isDragging=!1};var r=function(e){var i={left:e.pageX,top:e.pageY};if(e.target.ownerDocument!=window.document){var o=t(e.target.ownerDocument).hostIframe();if(o.length>0){var n=o.clientRect();i.top+=n.top,i.left+=n.left}}return i};n.prototype._buildContent=function(){this.$content=t(this.settings.content),this.$content.detach()},n.prototype.getWindow=function(){return window},n.prototype.getParent=function(){return this.settings.parentId?c(this.settings.parentId):null},n.prototype.center=function(){var t=this._getDefaultPosition();this.$container.animate({top:t.top},400)},n.prototype.pos=function(t){this.$container.stop(!0,!0);var e=this._getDefaultPosition();if(!0===t){var i=e.top;delete e.top,this.$container.css(e).animate({top:i},400)}else this.$container.css(e)},n.prototype.setTitle=function(t){this.$container.find(".dialog-header .dialog-header-text").text(t||"")},n.prototype.getTitle=function(){return this.$container.find(".dialog-header .dialog-header-text").text()};var a=function(){n.apply(this,arguments),this.settings.parentId&&(this._parentWindow=window.frames[this.settings.parentId])};t.extend(a.prototype,n.prototype),a.prototype.dialogType="iframe",a.prototype._setupCustomEvent=function(){n.prototype._setupCustomEvent.apply(this,arguments).add(s)};var s=function(i){for(var o=0;o<e.length;o++)e[o]._postCommand&&e[o]._postCommand("event"+i.type,t.extend({_eventDialogId:this.settings._fullId},i.data))};a.prototype._finishClose=function(t){n.prototype._finishClose.call(this,t),this.$frame[0].src="about:blank",this.$frame.remove()},a.prototype._destroy=function(){this.$el.remove()},a.prototype._buildContent=function(){this._iframeLoadTimer=null,this.$frame&&this.$frame.length>0&&this.$frame.remove(),this.$frame=t('<iframe src="'+this.settings.url+'" name="'+this.settings._fullId+'" seamless allowtransparency="true" width="100%" style="height:'+(this.height||this.settings.initialHeight)+'px;" class="dialog-frame" scrolling="no" frameborder="0" framespacing="0"></iframe>'),t.modalDialog.iframeLoadTimeout>0&&this.$frame.on("load",t.proxy(function(){this._isDeferredComplete("open")||(this._iframeLoadTimer=setTimeout(t.proxy(function(){this._isDeferredComplete("open")||(this.$frame.remove(),this._resetFailed(),this._rejectDeferred("open",[{message:"iframe load timeout for url: "+this.settings.url}]))},this),t.modalDialog.iframeLoadTimeout))},this)),this.$content=this.$frame},a.prototype._alreadyBuilt=function(){this._buildContent(),this.$contentContainer.append(this.$content)},a.prototype.getWindow=function(){return this.$frame.iframeWindow()[0]},a.prototype._postCommand=function(e,i){var o={dialogCmd:e};i&&t.extend(o,i);var n=t.param(o);this.postMessage(n)},a.prototype.postMessage=function(e){var i=this.getWindow(),o=this.frameHostname;o||(o=0===this.settings.url.indexOf("http")?this.settings.url:document.location.href),t.postMessage?t.postMessage(e,o,i):i.postMessage(e,"*")},a.prototype.setHeight=function(t,e,i){var o=i?function(t,e){t.css(e)}:function(t,e){t.animate(e,{duration:400})};if(o(this.$content,{height:t}),e){var n=this._getDefaultPosition(t);o(this.$content,{top:n.top})}this.height=t},a.prototype.setHeightFromContent=function(t,e){this._postCommand("setHeightFromContent",{center:!!t,skipAnimation:!!e})},a.prototype.setTitleFromContent=function(){this._postCommand("setTitleFromContent")},a.prototype.notifyReady=function(t){this._iframeLoadTimer&&(clearTimeout(this._iframeLoadTimer),this._iframeLoadTimer=null),this.frameHostname=t,n.prototype._finishOpen.apply(this)},a.prototype._finishOpen=function(){};var l=function(){n.apply(this,arguments)};t.extend(l.prototype,n.prototype),l.prototype.dialogType="ajax",l.prototype.open=function(){var e=n.prototype.open.apply(this,arguments);return this._ajaxComplete?n.prototype._finishOpen.call(this):this.$content.partialLoad(this.settings.url,null,t.proxy(function(e,i,o){this._ajaxComplete=!0,o.fail(t.proxy(function(){this._resetFailed();var t={xhr:o,status:i,responseText:e};this.onajaxerror.fire(t),this._rejectDeferred("open",[t])},this));var r=this.$content.find("title");this.settings.title||r.length>=0&&this.setTitle(r.text()),r.remove(),n.prototype._finishOpen.call(this)},this)),e.promise()},l.prototype._finishOpen=function(){},l.prototype._buildContent=function(){this.$content=t("<div class='dialog-content'></div>")},l.prototype._destroy=function(){this.$el.remove()};var d=-1;t.modalDialog._ensureSettings=function(e){var i,o=t.extend({},t.modalDialog.defaults);if(e.contentOrUrl&&(!function(t){var e=t.charAt(0);if("#"==e)return!0;if(t.indexOf("/")>=0)return!1;if("."==e){var i=t.charAt(1);return"."!=i&&"/"!=i}return!1}(e.contentOrUrl)?e.url=e.contentOrUrl:e.content=t(e.contentOrUrl),delete e.contentOrUrl),e.content){var n=t(e.content),r=t.modalDialog.getSettings(n);t.extend(o,r)}if(t.extend(o,e),o._fullId){var a=o._fullId.split("_");i=a.pop(),a.length>0&&(o.parentId=a.join("_"))}else{i="dialog"+(o.id||++d);var s=o.parentId?o.parentId+"_":"";o._fullId=s+i}return o},t.modalDialog._areSettingsEqual=function(t,e){for(var i in t)if("_fullId"!=i){var o=t[i],n=e[i];if(o!==n){if(o.jquery&&n.jquery&&o[0]===n[0])continue;return!1}}return!0};var c=function(t){return i[t]};t.modalDialog=t.modalDialog||{},t.modalDialog._isHost=!0,t.modalDialog.veilClass="dialog-veil";var h=[function(t){if(t.url){if(t.content)throw new Error("Both url and content cannot be specified.");return t.ajax?new l(t):new a(t)}return null},function(e){if(e.content){var i=t(e.content);if(0===i.length)throw new Error("ModalDialog content not found");e.content=i;var o=new n(e);return e.destroyOnClose||i.modalDialogInstance(o),o}return null}];t.modalDialog.registerPlugin=function(t,e){var i=t.call(this,n);e?h.unshift(i):h.push(i)},t.modalDialog.create=function(e){e=t.modalDialog._ensureSettings(e);var o=c(e._fullId);if(!o&&e.content){var n=t(e.content).modalDialogInstance();if(n&&e._fullId&&n.settings._fullId!==e._fullId&&n.isOpen())throw new Error("An attempt was made to create a dialog with a content node which is already assigned to another open dialog.")}if(!o){for(var r=0;r<h.length&&!(o=h[r].call(this,e));r++);if(!o)throw new Error("No url or content node specified");i[e._fullId]=o}return o},t.modalDialog.getCurrent=function(){return e.length>0?e[e.length-1]:null},t.modalDialog.getExisting=function(e){var o,n=t(e.content);if(n&&n.length?o=function(e){return e.content&&t(e.content)[0]===n[0]}:e.url&&(o=function(t){return t.url&&t.url===e.url&&!!t.ajax==!!e.ajax}),o)for(var r in i){var a=i[r];if(o(a.settings))return a}return null},t.CustomEvent.create(t.modalDialog,"beforeopen"),t.CustomEvent.create(t.modalDialog,"open"),t.CustomEvent.create(t.modalDialog,"beforeclose"),t.CustomEvent.create(t.modalDialog,"close");var u="modalDialog";t.fn.modalDialogInstance=function(t){return t?this.data(u,t):this.data(u)},t.fn.modalDialog=function(e){var i;if("string"==typeof e){var o=e;(i=this.modalDialogInstance())&&i[o]&&i[o].apply(i,Array.prototype.slice(arguments,1))}else(e=e||{}).content=this[0],(i=t.modalDialog.create(e)).open();return this};var p={setHeight:function(t,e){t.setHeight(parseInt(e.height,10),"true"===e.center,"true"===e.skipAnimation)},setTitle:function(t,e){e.initializing&&t.settings.title||t.setTitle(e.title)},open:function(t){t.open()},close:function(t){t.close()},create:function(){},center:function(t){t.center()},notifyReady:function(t,e){t.notifyReady(e.hostname)}},g=function(e){var i;try{i=t.deparam(e.originalEvent?e.originalEvent.data:e.data)}catch(t){}if(i&&i.dialogCmd){var o=p[i.dialogCmd];if(o)return o(i._fullId?t.modalDialog.create(i):t.modalDialog.getCurrent(),i),!0}return!1};t.receiveMessage?t.receiveMessage(g,"*"):t(window).on("message",g),window._dialogReceiveMessageManual=function(e,i){if(!g({data:e,origin:i})){var o=new t.Event("message");o.data=e,o.origin=i,t(window).trigger(o,[e,i])}},t(document).ready(function(){t.mobile&&(t.modalDialog.defaults=t.extend(t.modalDialog.defaults,{preventEventBubbling:!1}))})}(jQuery),function(t){var e=function(e,i){"iframe"==e.dialogType&&t([window,document]).enableEvent("touchmove touchstart touchend",!i)},i=function(){return window.innerHeight||t(window).height()};t(function(){if(t.modalDialog.isSmallScreen())if(t.modalDialog.veilClass="dialog-veil-opaque",t.modalDialog&&t.modalDialog._isContent){var o=t.modalDialog.getCurrent();o&&t(window).on("load",function(){e(o,!0)})}else t.modalDialog.onopen.add(function(){e(this,!0)}),t.modalDialog.onbeforeclose.add(function(){e(this,!1)}),function(){var e=t("[data-dialog-main-panel='true']");0===e.length&&(e=t("[data-dialog-hide-onopen='true']"));var o=0,n=0;t.modalDialog.onbeforeopen.add(function(){0===this.level&&(o=t(document).scrollTop(),n=document.body.style.height,e.each(function(e,i){t(i).data("dialog-parent",i.parentNode)}).detach(),document.body.style.height=i()+50+"px",window.scrollTo(0,1))}),t.modalDialog.onopen.add(function(){if(0===this.level){var e=Math.max(this.$container.height(),i())+20;document.body.style.height=e+"px",t(".dialog-background").css({height:e}),window.scrollTo(0,1)}}),t.modalDialog.onclose.add(function(){0===this.level&&(document.body.style.height=n,e.each(function(e,i){t(t(i).data("dialog-parent")).append(i)}),window.scrollTo(0,o))})}()})}(jQuery),function(t){var e="modalDialogUnobtrusive";t(document).on("click","[data-rel='modalDialog']",function(i){i.preventDefault();var o=t(i.currentTarget),n=o.attr("data-dialog-url")||o.attr("href");if(!n)throw new Error("no href specified with data-rel='modalDialog'");var r={contentOrUrl:n},a=t.modalDialog.getSettings(o);t.extend(r,a);var s=new t.Event("dialogsettingscreate");if(s.dialogSettings=r,o.trigger(s),!s.isDefaultPrevented()){var l=o.data(e);if(l){var d=t.modalDialog._ensureSettings(r);t.modalDialog._areSettingsEqual(l.settings,d)||(l._destroy(),l=null)}if(!l){if(l=t.modalDialog.create(r),(s=new t.Event("dialogcreate")).dialogSettings=r,s.dialog=l,o.trigger(s),s.isDefaultPrevented())return;r.destroyOnClose||o.data(e,l)}l.open()}}),t(document).on("click",".close-dialog",function(e){e.preventDefault(),setTimeout(function(){var e=t.modalDialog.getCurrent();e&&e.close()},0)})}(jQuery),function(t){var e;t.modalDialog.enableHistory=function(i){if(!l){l=!0,e=i||"sdialogid",o();var n=new t.Deferred;return f(!0).then(function(){try{t.modalDialog.onopen.add(u),t.modalDialog.onclose.add(p),History.Adapter.bind(window,"statechange",g),n.resolve()}catch(t){n.reject(t)}},function(t){n.reject(t)}),n}},t.modalDialog.isHistoryEnabled=function(){return l};var i=function(){if(History.emulated.pushState&&window.location.hash){var e=window.location.hash.indexOf("?");if(e>=0)return t.deparam(window.location.hash.substr(e))}return window.location.search?t.currentQueryString():{}},o=function(){for(var e=t.modalDialog.getCurrent();e;)e&&(e.settings.enableHistory=!1),e=e.getParent()},n=function(e){if(t.modalDialog._ua.ie&&t.modalDialog._ua.version<=8&&e.settings.url&&!e.settings.ajax)return!1;var i=e;do{if(i&&!i.settings.enableHistory)return!1;i=i.getParent()}while(i);return l},r=!0,a=!1,s=!1,l=!1,d=function(e){var i={dialogType:"node",dialogId:null};if(e.settings.content){var o=t(e.settings.content).prop("id");if(!o)throw new Error("The specified content node has no ID, and cannot be serialized to a URL parameter.");i.dialogId="#"+o}return!i.dialogId&&e.settings.url&&(i.dialogType=e.settings.ajax?"ajax":"iframe",i.dialogId=e.settings.url),i},c=function(e){if(!e)return[];var i=e.split(" ");return t.map(i,function(t){var e,i=t.indexOf("_");if(i<0)throw new Error("Invalid dialog parameters: "+t);return{dialogType:t.substr(0,i),dialogId:(e=t.substr(i+1),e.replace("-hash-","#"))}})},h=function(e){return t.map(e,function(t){return t.dialogType+"_"+t.dialogId.replace("#","-hash-")}).join(" ")},u=function(){if(!s&&n(this)){var o=d(this),l=i(),u=c(l[e]);if(this.level+1<=u.length)throw new Error("The number of dialogParams in the URL doesn't match the number of open dialogs. Not updating history.");u.push(o),l[e]=h(u);var p=t.appendQueryString(document.location.pathname,l);a=!0,History.pushState(null,document.title,p),r=!1}},p=function(){if(!s&&!1!==this.settings.enableHistory&&n(this)){if(r){var o=i(),l=c(o[e]),u=l.pop();if(g=u,(f=d(this)).dialogType!=g.dialogType||f.dialogId!=g.dialogId)throw new Error("Closed dialog does not match URL parameters: "+u.dialogType+","+u.dialogId+". History not updated.");0===l.length?delete o[e]:o[e]=h(l);var p=t.appendQueryString(document.location.pathname,o);History.pushState(null,document.title,p)}else a=!0,History.back();var g,f;r=!1}},g=function(){a?a=!1:f()},f=function(o){var n=new t.Deferred,r=c(i()[e]),a=t.modalDialog.getCurrent(),l=a?a.level+1:0;r.length===l&&n.resolve();var d=function(){if(r.length>l){var e=r[l],i=function(e){var i=null;if("iframe"==e.dialogType)i={url:e.dialogId};else if("ajax"==e.dialogType)i={ajax:!0,url:e.dialogId};else{var o;try{o=t(e.dialogId)}catch(t){}o&&o.length>0&&((i=t.modalDialog.getSettings(o)).content=o)}return i}(e);if(!i)return s=!1,void n.reject("Unable to create dialog settings from dialogId in URL: "+e.dialogType+","+e.dialogId);var a=t.modalDialog.getExisting(i);a||(a=t.modalDialog.create(i)),s=!0,a.open(o).then(function(){l++;try{d()}catch(t){n.reject(t)}})}else setTimeout(function(){n.resolve(),s=!1},0)};r.length>l&&d();var h=function(){if(r.length<l){var e=t.modalDialog.getCurrent();if(e){if(!e.settings.enableHistory)return n.resolve(),void(s=!1);s=!0,e.close().then(function(){l--;try{h()}catch(t){n.reject(t)}})}else s=!1,n.reject("There was a mismatch between the URL and the current open dialog stack")}else setTimeout(function(){n.resolve(),s=!1})};return r.length<l&&h(),n}}(jQuery);