<!doctype html>
<!--[if !IE]>      <html class="no-js non-ie" lang="en-US"> <![endif]-->
<!--[if IE 7 ]>    <html class="no-js ie7" lang="en-US"> <![endif]-->
<!--[if IE 8 ]>    <html class="no-js ie8" lang="en-US"> <![endif]-->
<!--[if IE 9 ]>    <html class="no-js ie9" lang="en-US"> <![endif]-->
<!--[if gt IE 9]><!--> <html class="no-js" lang="en-US"> <!--<![endif]-->
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <!--[if lt IE 9]> <script src="javascripts/html5shiv.js"></script> <![endif]-->

  <link rel='stylesheet' id='responsive-style-css' href='stylesheets/style.css' type='text/css' />
  <link rel='stylesheet' id='responsive-media-queries-css'  href='stylesheets/media-queries.css' type='text/css'/>
  <link rel="stylesheet" href="stylesheets/syntax-highlighting.css"/>

  <script type='text/javascript' src='javascripts/jquery.js'></script>
  <script type='text/javascript' src='javascripts/jquery-migrate.min.js'></script>
  <script type='text/javascript' src='javascripts/responsive-modernizr.js'></script>
  <script type="text/javascript" src="javascripts/script.js"></script>
  <script type="text/javascript" src="javascripts/toc.js"></script>

  <title>skinny.js</title>

  <meta name="description" content="Skinny JS">
  <meta name="viewport" content="width=device-width,initial-scale=1">

</head>

<body class="home blog front-page">
                 
  <div id="container" class="hfeed">
           
      <div id="header">
                 
        <div id="logo" class="skinny-logo">
            <a href="./">skinny.js</a>
        </div>
            
        <div class="main-nav">
          <ul class="menu">
            <li class="current_page_item"><a href="./" title="Home">Home</a></li>
            <li class="page_item"><a href="download-builder.html">Download</a></li>
            <li class="page_item"><a href="#" onclick="return false;">Documentation</a>
              <ul class='children'>
                <li class="page_item"><a href="#" onclick="return false;">Libraries</a>
                  <ul class="children">
                    <li class="page_item"><a href='date-parse.html'>date-parse</a></li>

                    <li class="page_item"><a href='jquery.breakpoints.html'>jQuery.breakpoints</a></li>

                    <li class="page_item"><a href='jquery.clientRect.html'>jQuery.clientRect</a></li>

                    <li class="page_item"><a href='jquery.cookies.html'>jQuery.cookies</a></li>

                    <li class="page_item"><a href='jquery.css.html'>jQuery.css</a></li>

                    <li class="page_item"><a href='jquery.customEvent.html'>jQuery.customEvent</a></li>

                    <li class="page_item"><a href='jquery.delimitedString.html'>jQuery.delimitedString</a></li>

                    <li class="page_item"><a href='jquery.disableEvent.html'>jQuery.disableEvent</a></li>

                    <li class="page_item"><a href='jquery.hostIframe.html'>jQuery.hostIframe</a></li>

                    <li class="page_item"><a href='jquery.hoverDelay.html'>jQuery.hoverDelay</a></li>

                    <li class="page_item"><a href='jquery.htmlEncode.html'>jQuery.htmlEncode</a></li>

                    <li class="page_item"><a href='jquery.imageSize.html'>jQuery.imageSize</a></li>

                    <li class="page_item"><a href='jquery.isVisibleKeyCode.html'>jQuery.isVisibleKeyCode</a></li>

                    <li class="page_item"><a href='jquery.partialLoad.html'>jQuery.partialLoad</a></li>

                    <li class="page_item"><a href='jquery.pointerEvents.html'>jQuery.pointerEvents</a></li>

                    <li class="page_item"><a href='jquery.pointerGestures.html'>jQuery.pointerGestures</a></li>

                    <li class="page_item"><a href='jquery.postMessage.html'>jQuery.postMessage</a></li>

                    <li class="page_item"><a href='jquery.proxyAll.html'>jQuery.proxyAll</a></li>

                    <li class="page_item"><a href='jquery.msAjax.html'>jQuery.msAjax</a></li>

                    <li class="page_item"><a href='jquery.ns.html'>jQuery.ns</a></li>

                    <li class="page_item"><a href='jquery.queryString.html'>jQuery.queryString</a></li>

                    <li class="page_item"><a href='jquery.scrollAnchor.html'>jQuery.scrollAnchor</a></li>

                    <li class="page_item"><a href='jquery.uncomment.html'>jQuery.uncomment</a></li>

                    <li class="page_item"><a href='jquery.url.html'>jQuery.url</a></li>

                  </ul>
                </li>
                <li class="page_item"><a href="#" onclick="return false;">UI Components</a>
                  <ul class="children">
                    <li class="page_item"><a href='jquery.menu.html'>jQuery.menu</a></li>

                    <li class="page_item"><a href='jquery.modalDialog.html'>jQuery.modalDialog</a></li>

                    <li class="page_item"><a href='jquery.richTooltip.html'>jQuery.richTooltip</a></li>
                </ul>
              </li>
              </ul>
            </li>
          </ul>
      </div>                
                   
    </div>
          
    <div id="wrapper" class="clearfix">

      <div class="grid col-940">
  <div class="widget-wrapper markdown-body">

     
    <div class="source-links">
        <a href="https://github.com/vistaprint/SkinnyJS/blob/master/js/jquery.postMessage.js" class="github-source-link" target="_blank">View on github</a> |
        <a href="docco/jquery.postMessage.html" class="docco-link">Annotated source</a>
    </div>
    

    <h2 id="jquery-postmessage-plugin">jQuery postMessage plugin</h2>

<p>Wraps HTML5 postMessage for cross-origin message sending between windows.
Fallback implementation works on browsers that don’t support postMessage.</p>

<p>Based on concepts from: <a href="http://benalman.com/projects/jquery-postmessage-plugin/">http://benalman.com/projects/jquery-postmessage-plugin/</a></p>

<p>Improved for non-awesome browsers by using iframes for communication instead of url fragments and polling. This technique eliminates race conditions where messages sent in rapid succession might not be received. It also removes the need for polling.</p>

<p>Supports almost any conceivable browser, tested with IE6+</p>

<h3 id="usage">Usage</h3>

<h4 id="polyfill-setup">Polyfill setup</h4>

<p>To support IE6-7 (and IE8-10 for non-frame windows), you need to make the polyfill HTML file (postmessage.htm) available on your web server.
For example, you could put the file here:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://www.mysite.com/scripts/thirdparty/skinnyjs/postmessage.htm
</code></pre></div></div>

<p>IMPORTANT: This file must be on the same domain as the content you want to communicate with. It cannot be hosted on a different domain (i.e. Google CDN).</p>

<p>Once the file is available, you need to configure the postMessage plugin to point to it. Add this line anywhere on your page (or as the first/last line of jquery.postMessage.js):</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="nb">window</span><span class="p">.</span><span class="nx">_jqueryPostMessagePolyfillPath</span> <span class="o">=</span> <span class="s2">"/scripts/thirdparty/skinnyjs/postmessage.htm"</span><span class="p">;</span></code></pre></figure>

<h4 id="sending-a-message-to-another-window">Sending a message to another window</h4>

<p>$.postMessage() has the following signature:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="nx">$</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span>
        <span class="nx">message</span><span class="p">,</span> <span class="c1">// The message to send (string)</span>
        <span class="nx">targetHost</span><span class="p">,</span> <span class="c1">// The host of the target window (i.e. http://www.vistaprint.com)</span>
        <span class="nx">targetWindow</span> <span class="c1">// A reference to the target window</span>
        <span class="p">);</span></code></pre></figure>

<p>Note that the $.postMessage() API is slightly different from the HTML5 standard window.postMessage(),
in that it requires explicitly specifying the domain of the target window. This is necessary because there’s
no way to determine the target window’s domain programatically, and the domain is required for the
polyfill technique to work.</p>

<p>Example usage:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="nx">$</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span>
        <span class="s2">"this is a message"</span><span class="p">,</span>
        <span class="s2">"http://www.foo.com"</span><span class="p">,</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">frames</span><span class="p">[</span><span class="s2">"fooWindow"</span><span class="p">]</span>
        <span class="p">);</span></code></pre></figure>

<h4 id="listening-to-messages-from-another-window">Listening to messages from another window</h4>

<p>To listen for messages from another window, use jQuery’s built in event handling infrastructure and listen for “message” events on the window object:</p>

<p>This example simply alerts every message it receives, from any origin:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"message"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">alert</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span> <span class="c1">// Alerts "this is a message"</span>
    <span class="p">});</span></code></pre></figure>

<p>In general, its a good idea to filter out requests from unknown domains. This example filters messages not from http://www.foo.com:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"message"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">origin</span> <span class="o">!==</span> <span class="s2">"http://www.foo.com"</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nx">alert</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span> <span class="c1">// Alerts "this is a message"</span>
        <span class="p">});</span></code></pre></figure>

<p>This example alerts every message it receives, from any subdomain of foo.com:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"message"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">origin</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="sr">/http:</span><span class="se">\/\/[^\.]</span><span class="sr">*</span><span class="se">\.</span><span class="sr">foo</span><span class="se">\.</span><span class="sr">com$/gi</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">alert</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span> <span class="c1">// Alerts "this is a message"</span>
    <span class="p">});</span></code></pre></figure>

<p>Its also a common practice to “namespace” messages so your handlers don’t respond to messages they don’t know how to handle:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">    <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">"message"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">origin</span> <span class="o">!==</span> <span class="s2">"http://www.foo.com"</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">"fruit:"</span><span class="p">)</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
         
        <span class="c1">// TODO: Remove the "fruit:" namespace and do something with the message</span>
    <span class="p">});</span></code></pre></figure>


  </div>
</div>
 

    </div><!-- end of #wrapper -->
  </div><!-- end of #container -->

  <div id="footer" class="clearfix">
    
      <div id="footer-wrapper">
      
          <div class="grid col-940">
          
            <div class="grid col-540"></div><!-- end of col-540 -->
           
            <div class="grid col-380 fit">
              <ul class="social-icons"></ul><!-- end of .social-icons -->         
            </div><!-- end of col-380 fit -->
           
          </div><!-- end of col-940 -->
                               
          <div class="grid col-300 copyright">
              &copy; 2013 <a href="http://www.vistaprint.com/" title="Vistaprint | Business Cards, Websites, Postcards, T-shirts And More">Vistaprint</a>
          </div><!-- end of .copyright -->
          
          <div class="grid col-300 scroll-top"><a href="#scroll-top" title="scroll to top">&uarr;</a></div>
          
          <div class="grid col-300 fit powered">
          </div><!-- end .powered -->
          
      </div><!-- end #footer-wrapper -->
      
  </div><!-- end #footer -->

  <script type='text/javascript' src='javascripts/responsive.js'></script>
</body>
</html>
